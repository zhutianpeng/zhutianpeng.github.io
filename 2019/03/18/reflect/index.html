<!DOCTYPE html>
<html lang="zh-cn">
  <head><meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>


<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">

<meta name="description" content="java反射"/><meta name="keywords" content="java - reflect, Ztxpp's Blog" /><link rel="alternate" href="/default" title="Ztxpp's Blog" ><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=2.11.0" />
<link rel="canonical" href="ztxpp.cc/2019/03/18/reflect/"/>

<link rel="stylesheet" type="text/css" href="/lib/fancybox/jquery.fancybox.css" /><link rel="stylesheet" type="text/css" href="/lib/nprogress/nprogress.min.css" />
<link rel="stylesheet" type="text/css" href="/css/style.css?v=2.11.0" />

<script id="baidu_push">
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>
<script>
  window.config = {"leancloud":{"app_id":null,"app_key":null},"toc":true,"fancybox":true,"pjax":true,"latex":false};
</script>

    <title>java反射 - Ztxpp's Blog</title>
  <meta name="generator" content="Hexo 5.1.1"></head>

  <body><div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/." class="logo">Ztxpp's Blog</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>

<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list"><a href="/">
        <li class="mobile-menu-item">首页
          </li>
      </a><a href="/archives/">
        <li class="mobile-menu-item">归档
          </li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">标签
          </li>
      </a><a href="/Base/">
        <li class="mobile-menu-item">文档
          </li>
      </a><a href="/life/">
        <li class="mobile-menu-item">生活
          </li>
      </a></ul>
</nav>
<div class="container" id="mobile-panel">
      <header id="header" class="header"><div class="logo-wrapper">
  <a href="/." class="logo">Ztxpp's Blog</a>
</div>

<nav class="site-navbar"><ul id="menu" class="menu"><li class="menu-item">
          <a class="menu-item-link" href="/">
            首页
            </a>
        </li>
      <li class="menu-item">
          <a class="menu-item-link" href="/archives/">
            归档
            </a>
        </li>
      <li class="menu-item">
          <a class="menu-item-link" href="/tags/">
            标签
            </a>
        </li>
      <li class="menu-item">
          <a class="menu-item-link" href="/Base/">
            文档
            </a>
        </li>
      <li class="menu-item">
          <a class="menu-item-link" href="/life/">
            生活
            </a>
        </li>
      </ul></nav>
</header>

      <main id="main" class="main">
        <div class="content-wrapper">
          <div id="content" class="content"><article class="post">
    <header class="post-header">
      <h1 class="post-title">java反射
        </h1>

      <div class="post-meta">
        <span class="post-time">
          2019-03-18
        </span></div>
    </header>

    <div class="post-toc" id="post-toc">
    <h2 class="post-toc-title">文章目录</h2>
    <div class="post-toc-content">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1-java%E7%9A%84%E5%8F%8D%E5%B0%84%E6%9C%BA%E5%88%B6"><span class="toc-text">1.java的反射机制</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E4%BD%BF%E7%94%A8%E5%8F%8D%E5%B0%84%E8%8E%B7%E5%8F%96%E7%B1%BB%E7%9A%84%E4%BF%A1%E6%81%AF"><span class="toc-text">1. 使用反射获取类的信息</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-java%E5%8F%8D%E5%B0%84%E5%9C%A8%E9%A1%B9%E7%9B%AE%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8"><span class="toc-text">2. java反射在项目中的应用</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1-%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F"><span class="toc-text">2.1 工厂模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-3-Spring%E7%9A%84AOP%E4%B8%AD%E7%9A%84%E5%8F%8D%E5%B0%84-%E4%BD%BF%E7%94%A8%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F%E5%AE%9E%E7%8E%B0"><span class="toc-text">2.3 Spring的AOP中的反射(使用动态代理模式实现)</span></a></li></ol></li></ol>
    </div>
  </div><div class="post-content"><p>总结一下java中的反射的基础知识，以及反射的应用（Spring）</p>
<h1 id="1-java的反射机制"><a href="#1-java的反射机制" class="headerlink" title="1.java的反射机制"></a>1.java的反射机制</h1><p>Java 反射机制在程序运行时，对于任意一个类，都能够知道这个类的所有属性和方法；对于任意一个对象，都能够调用它的任意一个方法和属性。这种 动态的获取信息 以及 动态调用对象的方法 的功能称为 java 的反射机制。举例如下： </p>
<p>父类：FatherClass</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FatherClass</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> String mFatherName;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> mFatherAge;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> testa;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">printFatherMsg</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>子类：SonClass</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SonClass</span> <span class="keyword">extends</span> <span class="title">FatherClass</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String mSonName;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">int</span> mSonAge;</span><br><span class="line">    <span class="keyword">public</span> String mSonBirthday;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">printSonMsg</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Son Msg - name : &quot;</span></span><br><span class="line">                + mSonName + <span class="string">&quot;; age : &quot;</span> + mSonAge);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">setSonName</span><span class="params">(String name)</span></span>&#123;</span><br><span class="line">        mSonName = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">setSonAge</span><span class="params">(<span class="keyword">int</span> age)</span></span>&#123;</span><br><span class="line">        mSonAge = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">getSonAge</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> mSonAge;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">getSonName</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> mSonName;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="1-使用反射获取类的信息"><a href="#1-使用反射获取类的信息" class="headerlink" title="1. 使用反射获取类的信息"></a>1. 使用反射获取类的信息</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 通过反射获取类的所有变量</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">printFields</span><span class="params">()</span> <span class="keyword">throws</span> NoSuchFieldException, IllegalAccessException </span>&#123;</span><br><span class="line">    <span class="comment">//1.获取并输出类的名称</span></span><br><span class="line">    Class mClass = SonClass.class;</span><br><span class="line">    System.out.println(<span class="string">&quot;类的名称：&quot;</span> + mClass.getName());</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2.1 获取所有 public 访问权限的变量</span></span><br><span class="line">    <span class="comment">// 包括本类声明的和从父类继承的</span></span><br><span class="line">    Field[] fields = mClass.getFields();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2.2 获取所有本类声明的变量（不问访问权限）</span></span><br><span class="line">    <span class="comment">// Field[] fields = mClass.getDeclaredFields();</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//2.3 获取父类的private方变量</span></span><br><span class="line">    <span class="comment">// Field fi = mClass.getSuperclass().getDeclaredField(&quot;testa&quot;);</span></span><br><span class="line">    <span class="comment">// System.out.println(&quot;1:&quot;+Modifier.toString(fi.getModifiers()) + &quot; &quot;+fi.getType().getName() + &quot; &quot; + fi.getName());</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//3. 遍历变量并输出变量信息</span></span><br><span class="line">    <span class="keyword">for</span> (Field field : fields) &#123;</span><br><span class="line">        <span class="comment">//获取访问权限并输出</span></span><br><span class="line">        <span class="keyword">int</span> modifiers = field.getModifiers();</span><br><span class="line">        System.out.print(Modifier.toString(modifiers) + <span class="string">&quot; &quot;</span>);</span><br><span class="line">        <span class="comment">//输出变量的类型及变量名</span></span><br><span class="line">        System.out.println(field.getType().getName() + <span class="string">&quot; &quot;</span> + field.getName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">```  </span><br><span class="line">输出：<span class="number">2.1</span> getFields() 包括了 子类的<span class="keyword">public</span>属性和继承自父类的所有属性（当然继承的<span class="keyword">public</span>的） </span><br></pre></td></tr></table></figure>
<p>类的名称：fanshe.SonClass<br>public java.lang.String mSonBirthday<br>public java.lang.String mFatherName<br>public int mFatherAge</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">输出：2.2 getDeclaredFields()方法： 包括了 子类所有的属性，不问访问权限</span><br></pre></td></tr></table></figure>
<p>类的名称：fanshe.SonClass<br>private java.lang.String mSonName<br>protected int mSonAge<br>public java.lang.String mSonBirthday</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">输出2.3 想获取父类的信息，先getSuperclass(), 然后再 getDeclaredField(), 即可拿到private 属性  </span><br></pre></td></tr></table></figure>
<p>类的名称：fanshe.SonClass<br>1:private int testa</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">## 2. 获取类的所有方法信息</span><br><span class="line">&#96;&#96;&#96;java</span><br><span class="line">private static void printMethods()&#123;</span><br><span class="line">        &#x2F;&#x2F;1.获取并输出类的名称</span><br><span class="line">        Class mClass &#x3D; SonClass.class;</span><br><span class="line">        System.out.println(&quot;类的名称：&quot; + mClass.getName());</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F;2.1 获取所有 public 访问权限的方法</span><br><span class="line">        &#x2F;&#x2F;包括自己声明和从父类继承的</span><br><span class="line">       Method[] mMethods &#x3D; mClass.getMethods();</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F;2.2 获取所有本类的的方法（不问访问权限）</span><br><span class="line">        &#x2F;&#x2F; Method[] mMethods &#x3D; mClass.getDeclaredMethods();</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F;3.遍历所有方法</span><br><span class="line">        for (Method method : mMethods) &#123;</span><br><span class="line">            &#x2F;&#x2F;获取并输出方法的访问权限（Modifiers：修饰符）</span><br><span class="line">            int modifiers &#x3D; method.getModifiers();</span><br><span class="line">            System.out.print(Modifier.toString(modifiers) + &quot; &quot;);</span><br><span class="line">            &#x2F;&#x2F;获取并输出方法的返回值类型</span><br><span class="line">            Class returnType &#x3D; method.getReturnType();</span><br><span class="line">            System.out.print(returnType.getName() + &quot; &quot; + method.getName() + &quot;( &quot;);</span><br><span class="line">            &#x2F;&#x2F;获取并输出方法的所有参数</span><br><span class="line">            Parameter[] parameters &#x3D; method.getParameters();</span><br><span class="line">            for (Parameter parameter: parameters) &#123;</span><br><span class="line">                System.out.print(parameter.getType().getName() + &quot; &quot; + parameter.getName() + &quot;,&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">            &#x2F;&#x2F;获取并输出方法抛出的异常</span><br><span class="line">            Class[] exceptionTypes &#x3D; method.getExceptionTypes();</span><br><span class="line">            if (exceptionTypes.length &#x3D;&#x3D; 0)&#123;</span><br><span class="line">                System.out.println(&quot; )&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">            else &#123;</span><br><span class="line">                for (Class c : exceptionTypes) &#123;</span><br><span class="line">                    System.out.println(&quot; ) throws &quot; + c.getName());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#96;&#96;&#96;  </span><br><span class="line"></span><br><span class="line">输出: 2.1 getMethods() 拿到了本类的所有public方法，包括从父类继承来的:</span><br></pre></td></tr></table></figure>
<p>类的名称：fanshe.SonClass<br>public void printSonMsg(  )         //自己的方法<br>public void printFatherMsg(  )      //从父类继承来的方法<br>public final void wait(  ) throws java.lang.InterruptedException // 下面的方法来自 Object 类。<br>public final void wait( long arg0,int arg1, ) throws java.lang.InterruptedException<br>public final native void wait( long arg0, ) throws java.lang.InterruptedException<br>public boolean equals( java.lang.Object arg0, )<br>public java.lang.String toString(  )<br>public native int hashCode(  )<br>public final native java.lang.Class getClass(  )<br>public final native void notify(  )<br>public final native void notifyAll(  )</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">输出： 2.2 getDeclaredMethods(); 拿到了这个类中定义的所有方法，不包括继承来的，但是包含private方法</span><br></pre></td></tr></table></figure>
<p>类的名称：fanshe.SonClass<br>private void setSonName( java.lang.String arg0, )<br>private int getSonAge(  )<br>private void setSonAge( int arg0, )<br>public void printSonMsg(  )<br>private java.lang.String getSonName(  )</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">## 3. 访问或操作类的私有变量和方法</span><br><span class="line">定义类：TestClass</span><br><span class="line">&#96;&#96;&#96;java</span><br><span class="line">public class TestClass &#123;</span><br><span class="line"></span><br><span class="line">    private String MSG &#x3D; &quot;Original&quot;;                       &#x2F;&#x2F;private变量</span><br><span class="line"></span><br><span class="line">    private void privateMethod(String head , int tail)&#123;    &#x2F;&#x2F;private方法</span><br><span class="line">        System.out.print(head + tail);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getMsg()&#123;</span><br><span class="line">        return MSG;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>利用 getPrivateMethod() 获取私有方法:<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 访问对象的私有方法</span></span><br><span class="line"><span class="comment">     * 为简洁代码，在方法上抛出总的异常，实际开发别这样</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">getPrivateMethod</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        <span class="comment">//1. 获取 Class 类实例</span></span><br><span class="line">        TestClass testClass = <span class="keyword">new</span> TestClass();</span><br><span class="line">        Class mClass = testClass.getClass();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2. 获取私有方法</span></span><br><span class="line">        <span class="comment">//第一个参数为要获取的私有方法的名称</span></span><br><span class="line">        <span class="comment">//第二个为要获取方法的参数的类型，参数为 Class，没有参数就是null</span></span><br><span class="line">        <span class="comment">//方法参数也可这么写 ：new Class[]&#123;String.class , int.class&#125;</span></span><br><span class="line">        Method privateMethod = mClass.getDeclaredMethod(<span class="string">&quot;privateMethod&quot;</span>, String.class, <span class="keyword">int</span>.class);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3. 开始操作方法</span></span><br><span class="line">        <span class="keyword">if</span> (privateMethod != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">//获取私有方法的访问权</span></span><br><span class="line">            <span class="comment">//只是获取访问权，并不是修改实际权限</span></span><br><span class="line">            privateMethod.setAccessible(<span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//使用 invoke 反射调用私有方法</span></span><br><span class="line">            <span class="comment">//privateMethod 是获取到的私有方法</span></span><br><span class="line">            <span class="comment">//testClass 要操作的对象</span></span><br><span class="line">            <span class="comment">//后面两个参数传实参</span></span><br><span class="line">            privateMethod.invoke(testClass, <span class="string">&quot;Java Reflect &quot;</span>, <span class="number">666</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>输出： 调用私有方法成功</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Java Reflect 666</span><br></pre></td></tr></table></figure>

<ul>
<li>利用modifyPrivateFiled() 修改私有变量：<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 修改对象私有变量的值</span></span><br><span class="line"><span class="comment"> * 为简洁代码，在方法上抛出总的异常</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">modifyPrivateFiled</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="comment">//1. 获取 Class 类实例</span></span><br><span class="line">    TestClass testClass = <span class="keyword">new</span> TestClass();</span><br><span class="line">    Class mClass = testClass.getClass();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2. 获取私有变量</span></span><br><span class="line">    Field privateField = mClass.getDeclaredField(<span class="string">&quot;MSG&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//3. 操作私有变量</span></span><br><span class="line">    <span class="keyword">if</span> (privateField != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="comment">//获取私有变量的访问权</span></span><br><span class="line">        privateField.setAccessible(<span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//修改私有变量，并输出以测试</span></span><br><span class="line">        System.out.println(<span class="string">&quot;Before Modify：MSG = &quot;</span> + testClass.getMsg());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//调用 set(object , value) 修改变量的值</span></span><br><span class="line">        <span class="comment">//privateField 是获取到的私有变量</span></span><br><span class="line">        privateField.set(testClass, <span class="string">&quot;Modified&quot;</span>); <span class="comment">//testClass 要操作的对象, &quot;Modified&quot; 为要修改成的值</span></span><br><span class="line">        System.out.println(<span class="string">&quot;After Modify：MSG = &quot;</span> + testClass.getMsg());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Before Modify：MSG &#x3D; Original</span><br><span class="line">After Modify：MSG &#x3D; Modified</span><br></pre></td></tr></table></figure>
<p>反射基础部分借鉴：<a target="_blank" rel="noopener" href="https://juejin.im/post/598ea9116fb9a03c335a99a4">https://juejin.im/post/598ea9116fb9a03c335a99a4</a></p>
<h1 id="2-java反射在项目中的应用"><a href="#2-java反射在项目中的应用" class="headerlink" title="2. java反射在项目中的应用"></a>2. java反射在项目中的应用</h1><h2 id="2-1-工厂模式"><a href="#2-1-工厂模式" class="headerlink" title="2.1 工厂模式"></a>2.1 工厂模式</h2><p>例子：国家电网能力开放平台 项目 之中的 “计费” 使用的是 工厂模式。</p>
<p>接口类： （计费）   </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component(&quot;chargeService&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ChargeServiceI</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">charge</span><span class="params">(JSONObject j)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">checkStatus</span><span class="params">(JSONObject j)</span> <span class="keyword">throws</span> Exception</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>实现类1：ChargeByQueryServiceImpl（按照请求次数计费） 不用管具体实现，知道有两个方法为charge(), checkStatus() 即可</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component(&quot;chargeByQueryServiceImpl&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ChargeByQueryServiceImpl</span> <span class="keyword">implements</span> <span class="title">ChargeServiceI</span> </span>&#123;</span><br><span class="line"><span class="comment">//    @Autowired</span></span><br><span class="line"><span class="comment">//    ChargeAccountServiceI chargeAccountService;</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SystemService systemService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AlarmService alarmService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SearchMethod searchMethod;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">charge</span><span class="params">(JSONObject j)</span> </span>&#123;</span><br><span class="line">        ChargeAccountEntity c = <span class="keyword">new</span> ChargeAccountEntity();</span><br><span class="line">        c.setId(j.get(<span class="string">&quot;chargeAccountId&quot;</span>).toString());</span><br><span class="line">        c.setTypename(j.get(<span class="string">&quot;typename&quot;</span>).toString());</span><br><span class="line">        c.setRestState(String.valueOf(Integer.parseInt(j.get(<span class="string">&quot;restState&quot;</span>).toString())-<span class="number">1</span>));</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            ChargeAccountServiceI chargeAccountService = (ChargeAccountServiceI) SpringContextUtils.getBean(<span class="string">&quot;chargeAccountService&quot;</span>);</span><br><span class="line">            chargeAccountService.saveOrUpdate(c);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            systemService.addLog(<span class="string">&quot;计费失败&quot;</span>, Globals.Log_Type_UPDATE, Globals.Log_Leavel_ERROR,<span class="string">&quot;1&quot;</span>);</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">checkStatus</span><span class="params">(JSONObject j)</span> <span class="keyword">throws</span> ControlException</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (Integer.parseInt(j.get(<span class="string">&quot;restState&quot;</span>).toString())&gt;<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//alarmService.writeDatabase(&quot;剩余次数不足！&quot;,&quot;1&quot;,apiId,appName);</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> ControlException(<span class="string">&quot;剩余次数不足，请充值！&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>实现类2：ChargeByFlowServiceImpl（按照流量计费）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ChargeByFlowServiceImpl</span> <span class="keyword">implements</span> <span class="title">ChargeServiceI</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    ChargeAccountServiceI chargeAccountService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SystemService systemService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AlarmService alarmService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SearchMethod searchMethod;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">charge</span><span class="params">(JSONObject j)</span> <span class="keyword">throws</span> ControlException </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> restState = Integer.parseInt(j.get(<span class="string">&quot;restState&quot;</span>).toString()) - Integer.parseInt(j.get(<span class="string">&quot;flowAmount&quot;</span>).toString());</span><br><span class="line">        ChargeAccountEntity c = <span class="keyword">new</span> ChargeAccountEntity();</span><br><span class="line">        <span class="keyword">if</span> (restState &lt; <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> ControlException(<span class="string">&quot;流量超出限额&quot;</span>);</span><br><span class="line">        c.setId(j.get(<span class="string">&quot;chargeAccountId&quot;</span>).toString());</span><br><span class="line">        c.setTypename(j.get(<span class="string">&quot;typename&quot;</span>).toString());</span><br><span class="line">        c.setRestState(String.valueOf(restState));</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            chargeAccountService.saveOrUpdate(c);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            systemService.addLog(<span class="string">&quot;计费失败&quot;</span>, Globals.Log_Type_UPDATE, Globals.Log_Leavel_ERROR, <span class="string">&quot;1&quot;</span>);</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">checkStatus</span><span class="params">(JSONObject j)</span> <span class="keyword">throws</span> ControlException </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (Integer.parseInt(j.get(<span class="string">&quot;restState&quot;</span>).toString()) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> ControlException(<span class="string">&quot;剩余流量不足，请充值！&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>实现类3：ChargeByPeriodServiceImpl（按照时间计费）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ChargeByPeriodServiceImpl</span> <span class="keyword">implements</span> <span class="title">ChargeServiceI</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AlarmService alarmService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SearchMethod searchMethod;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">charge</span><span class="params">(JSONObject j)</span> </span>&#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">checkStatus</span><span class="params">(JSONObject j)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        DateFormat dateFormat = <span class="keyword">new</span> SimpleDateFormat(<span class="string">&quot;yyyy-MM-dd&quot;</span>);</span><br><span class="line">        Date expireDate = dateFormat.parse(j.get(<span class="string">&quot;restState&quot;</span>).toString());</span><br><span class="line">        Date today = <span class="keyword">new</span> Date();</span><br><span class="line">        <span class="keyword">if</span> (today.before(expireDate) || DateUtils.isSameDay(expireDate, today)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//alarmService.writeDatabase(&quot;订购已经到期！&quot;,&quot;2&quot;,apiId,appName);</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> Exception(<span class="string">&quot;订购已经到期，请续订！&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">```   </span><br><span class="line"></span><br><span class="line">工厂类：</span><br><span class="line"></span><br><span class="line">```java</span><br><span class="line"><span class="meta">@Component(&quot;chargeFactory&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ChargeFactory</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    ChargeAccountServiceI chargeAccountService;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">checkStatus</span><span class="params">(JSONObject param)</span> <span class="keyword">throws</span> ControlException </span>&#123;</span><br><span class="line">        <span class="keyword">boolean</span> status = <span class="keyword">false</span>;</span><br><span class="line">        Class l = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            l = Class.forName(param.get(<span class="string">&quot;typename&quot;</span>).toString());</span><br><span class="line">            Object obj1 = l.newInstance();</span><br><span class="line">            Method m = l.getMethod(<span class="string">&quot;checkStatus&quot;</span>, param.getClass());</span><br><span class="line">            status = (<span class="keyword">boolean</span>) m.invoke(obj1, param);</span><br><span class="line">            <span class="keyword">return</span> status;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ControlException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> ControlException(e.msg);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InstantiationException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InvocationTargetException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> ControlException(e.getTargetException().getMessage());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchMethodException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> status;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">charge</span><span class="params">(JSONObject param)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        Class l = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            l = Class.forName(param.get(<span class="string">&quot;typename&quot;</span>).toString());</span><br><span class="line">            Object classObj = l.newInstance();</span><br><span class="line">            Method m = l.getMethod(<span class="string">&quot;charge&quot;</span>, param.getClass());</span><br><span class="line">            m.invoke(classObj,param);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ControlException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> ControlException(e.msg);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InvocationTargetException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InstantiationException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchMethodException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>工厂模式示意图：<br><img src="https://selfstudy.oss-cn-beijing.aliyuncs.com/blog/java-reflect1.png" alt="工厂模式结构"></p>
</li>
<li><p>反射相关</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    Class Son = Class.forName(<span class="string">&quot;fanshe.SonClass&quot;</span>);</span><br><span class="line">    Object son = Son.newInstance();</span><br><span class="line">    Method method = Son.getMethod(<span class="string">&quot;printSonMsg&quot;</span>);</span><br><span class="line">    method.invoke(son);</span><br><span class="line">&#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125; <span class="keyword">catch</span> (NoSuchMethodException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125; <span class="keyword">catch</span> (InvocationTargetException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">```  </span><br><span class="line"></span><br><span class="line">## 2.2 Spring的IOC中的反射</span><br><span class="line">只要在代码或配置文件中看到类的完整路径（包.类），其底层原理基本上使用的就是Java的反射机制。对于Spring，主要关注IOC底层实现的原理（反射），Bean容器的实现。</span><br><span class="line"></span><br><span class="line">- 示例<span class="number">1</span>： 基于 的 Spring 构造器的注入：</span><br><span class="line">```xml</span><br><span class="line">&lt;bean id=&quot;courseDao&quot; class=&quot;com.qcjy.learning.Dao.impl.CourseDaoImpl&quot;&gt;&lt;/bean&gt;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>伪代码解释：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">//解析<span class="tag">&lt;<span class="name">bean</span> <span class="attr">...</span>/&gt;</span>元素的id属性得到该字符串值为“courseDao”</span><br><span class="line">String idStr = &quot;courseDao&quot;;</span><br><span class="line">//解析<span class="tag">&lt;<span class="name">bean</span> <span class="attr">...</span>/&gt;</span>元素的class属性得到该字符串值为“com.qcjy.learning.Dao.impl.CourseDaoImpl”</span><br><span class="line">String classStr = &quot;com.qcjy.learning.Dao.impl.CourseDaoImpl&quot;;</span><br><span class="line">//利用反射知识，通过classStr获取Class类对象</span><br><span class="line">Class<span class="tag">&lt;<span class="name">?</span>&gt;</span> cls = Class.forName(classStr);</span><br><span class="line">//实例化对象</span><br><span class="line">Object obj = cls.newInstance();</span><br><span class="line">//container表示Spring容器</span><br><span class="line">container.put(idStr, obj);</span><br></pre></td></tr></table></figure>

<ul>
<li>示例2：含属性的bean 通过setter注入：</li>
</ul>
<p>当一个类里面需要应用另一类的对象时，Spring的配置如下所示：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;courseService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.qcjy.learning.service.impl.CourseServiceImpl&quot;</span>&gt;</span></span><br><span class="line">     <span class="comment">&lt;!-- 控制调用setCourseDao()方法，将容器中的courseDao bean作为传入参数 --&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;courseDao&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;courseDao&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">```   </span><br><span class="line"></span><br><span class="line">伪代码解释：</span><br><span class="line">```xml</span><br><span class="line">//解析<span class="tag">&lt;<span class="name">property</span> <span class="attr">...</span>/&gt;</span>元素的name属性得到该字符串值为“courseDao”</span><br><span class="line">String nameStr = &quot;courseDao&quot;;</span><br><span class="line">//解析<span class="tag">&lt;<span class="name">property</span> <span class="attr">...</span>/&gt;</span>元素的ref属性得到该字符串值为“courseDao”</span><br><span class="line">String refStr = &quot;courseDao&quot;;</span><br><span class="line">//生成将要调用setter方法名</span><br><span class="line">String setterName = &quot;set&quot; + nameStr.substring(0, 1).toUpperCase()</span><br><span class="line">		+ nameStr.substring(1);</span><br><span class="line">//获取spring容器中名为refStr的Bean，该Bean将会作为传入参数</span><br><span class="line">Object paramBean = container.get(refStr);</span><br><span class="line">//获取setter方法的Method类，此处的cls是刚才反射代码得到的Class对象</span><br><span class="line">Method setter = cls.getMethod(setterName, paramBean.getClass());</span><br><span class="line">//调用invoke()方法，此处的obj是刚才反射代码得到的Object对象</span><br><span class="line">setter.invoke(obj, paramBean);</span><br></pre></td></tr></table></figure>

<p>Spring的IOC部分借鉴：<a target="_blank" rel="noopener" href="https://blog.csdn.net/mlc1218559742/article/details/52774805">https://blog.csdn.net/mlc1218559742/article/details/52774805</a></p>
<h2 id="2-3-Spring的AOP中的反射-使用动态代理模式实现"><a href="#2-3-Spring的AOP中的反射-使用动态代理模式实现" class="headerlink" title="2.3 Spring的AOP中的反射(使用动态代理模式实现)"></a>2.3 Spring的AOP中的反射(使用动态代理模式实现)</h2><ul>
<li>代理模式：静态代理和动态代理，静态代理，顾名思义，就是你自己写代理对象，动态代理，则是在运行期，生成一个代理对象。</li>
<li>AOP：Spring AOP就是基于动态代理的，如果要代理的对象，实现了某个接口，那么Spring AOP会使用JDK Proxy，去创建代理对象。<br>对于没有实现接口的对象，就无法使用JDK Proxy去进行代理了，Spring AOP会使用Cglib，生成一个被代理对象的子类，来作为代理。</li>
</ul>
<p>简单的示例：</p>
<p>Interface: IOperation</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IOperation</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 方法执行之前的操作</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> method</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">start</span><span class="params">(Method method)</span></span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 方法执行之后的操作</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> method</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">end</span><span class="params">(Method method)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>实现类：LoggerOperation</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoggerOperation</span> <span class="keyword">implements</span> <span class="title">IOperation</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">end</span><span class="params">(Method method)</span> </span>&#123;</span><br><span class="line">        Logger.logging(Level.DEBUGE, method.getName() + <span class="string">&quot; Method end .&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">start</span><span class="params">(Method method)</span> </span>&#123;</span><br><span class="line">        Logger.logging(Level.INFO, method.getName() + <span class="string">&quot; Method Start!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>代理类:DynaProxyHello</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationHandler;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Proxy;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DynaProxyHello</span> <span class="keyword">implements</span> <span class="title">InvocationHandler</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 操作者</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Object proxy;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 要处理的对象(也就是我们要在方法的前后加上业务逻辑的对象,如例子中的Hello)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Object delegate;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 动态生成方法被处理过后的对象 (写法固定)</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> delegate</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> proxy</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">bind</span><span class="params">(Object delegate,Object proxy)</span> </span>&#123;</span><br><span class="line">       </span><br><span class="line">        <span class="keyword">this</span>.proxy = proxy;</span><br><span class="line">        <span class="keyword">this</span>.delegate = delegate;</span><br><span class="line">        <span class="keyword">return</span> Proxy.newProxyInstance(</span><br><span class="line">                <span class="keyword">this</span>.delegate.getClass().getClassLoader(), <span class="keyword">this</span>.delegate</span><br><span class="line">                        .getClass().getInterfaces(), <span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 要处理的对象中的每个方法会被此方法送去JVM调用,也就是说,要处理的对象的方法只能通过此方法调用</span></span><br><span class="line"><span class="comment">     * 此方法是动态的,不是手动调用的</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        Object result = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">//反射得到操作者的实例</span></span><br><span class="line">            Class clazz = <span class="keyword">this</span>.proxy.getClass();</span><br><span class="line">            <span class="comment">//反射得到操作者的Start方法</span></span><br><span class="line">            Method start = clazz.getDeclaredMethod(<span class="string">&quot;start&quot;</span>,<span class="keyword">new</span> Class[] &#123; Method.class &#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="comment">//反射执行start方法</span></span><br><span class="line">            start.invoke(<span class="keyword">this</span>.proxy, <span class="keyword">new</span> Object[] &#123; method &#125;);</span><br><span class="line">            <span class="comment">//执行要处理对象的原本方法</span></span><br><span class="line">            result = method.invoke(<span class="keyword">this</span>.delegate, args);</span><br><span class="line">            <span class="comment">//反射得到操作者的end方法</span></span><br><span class="line">            Method end = clazz.getDeclaredMethod(<span class="string">&quot;end&quot;</span>,<span class="keyword">new</span> Class[] &#123; Method.class &#125;);</span><br><span class="line">            <span class="comment">//反射执行end方法</span></span><br><span class="line">            end.invoke(<span class="keyword">this</span>.proxy, <span class="keyword">new</span> Object[] &#123; method &#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Spring的AOP部分借鉴：<a target="_blank" rel="noopener" href="https://blog.csdn.net/fuzhongmin05/article/details/61615149">https://blog.csdn.net/fuzhongmin05/article/details/61615149</a></p>

      </div>
      <div class="post-copyright">
    <p class="copyright-item">
      <span>原文作者: </span>
      <a href="ztxpp.cc">zhutianpeng</a>
    </p>
    <p class="copyright-item">
      <span>原文链接: </span>
      <a href="ztxpp.cc/2019/03/18/reflect/">ztxpp.cc/2019/03/18/reflect/</a>
    </p>
    <p class="copyright-item">
      <span>许可协议: </span><a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/" target="_blank">知识共享署名-非商业性使用 4.0 国际许可协议</a>
    </p>
  </div>
      <footer class="post-footer">
        <div class="post-tags">
            <a href="/tags/java-reflect/">java - reflect</a>
            </div>
        
        <nav class="post-nav"><a class="prev" href="/2019/03/19/%E5%9F%BA%E4%BA%8E%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%A7%86%E8%A7%89%E7%9A%84%E4%BA%BA%E4%BD%93%E5%A7%BF%E6%80%81%E4%BC%B0%E8%AE%A1%E5%B9%B3%E5%8F%B0%20%EF%BC%88%E9%A1%B9%E7%9B%AE%E8%B4%9F%E8%B4%A3%E4%BA%BA%EF%BC%89/">
        <i class="iconfont icon-left"></i>
        <span class="prev-text nav-default">项目介绍</span>
        <span class="prev-text nav-mobile">上一篇</span>
      </a>
    <a class="next" href="/2019/03/17/4-sort/">
        <span class="next-text nav-default">java实现的排序算法</span>
        <span class="prev-text nav-mobile">下一篇</span>
        <i class="iconfont icon-right"></i>
      </a>
    </nav></footer>
    </article></div><div class="comments" id="comments"></div></div>
      </main>

      <footer id="footer" class="footer"><div class="social-links"><a href="mailto:your@email.com" class="iconfont icon-email" title="email"></a>
        <a target="_blank" rel="noopener" href="https://github.com/ahonn" class="iconfont icon-github" title="github"></a>
        <a href="/atom.xml" class="iconfont icon-rss" title="rss"></a>
    </div><div class="copyright">
  <span class="power-by">
    由 <a class="hexo-link" target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a> 强力驱动
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    主题 - 
    <a class="theme-link" target="_blank" rel="noopener" href="https://github.com/ahonn/hexo-theme-even">Even</a>
  </span>

  <span class="copyright-year">&copy;2015 - 2021<span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">zhutianpeng</span>
  </span>
</div>
</footer>

      <div class="back-to-top" id="back-to-top">
        <i class="iconfont icon-up"></i>
      </div>
    </div><script type="text/javascript" src="/lib/jquery/jquery.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout.js"></script>
  <script type="text/javascript" src="/lib/fancybox/jquery.fancybox.pack.js"></script>
  <script type="text/javascript" src="/lib/pjax/jquery.pjax.min.js"></script>
  <script type="text/javascript" src="/lib/nprogress/nprogress.min.js"></script>
  <script type="text/javascript" src="/js/src/even.js?v=2.11.0"></script>
</body>
</html>
